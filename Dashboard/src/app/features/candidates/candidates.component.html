<div class="candidates-container">
  <!-- Header Section -->
  <div class="candidates-header">
    <h1>Candidate Management</h1>
  </div>

  <!-- Upload Section -->
  <div class="upload-section">
    <mat-card class="upload-card">
      <mat-card-content>
        <div class="upload-area"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)"
             (drop)="onDrop($event)"
             [class.dragging]="isDragging">
          
          <input type="file" 
                 #fileInput 
                 (change)="onFileSelected($event)"
                 accept=".pdf,.doc,.docx"
                 style="display: none">
          
          <div class="upload-content">
            <mat-icon class="upload-icon">cloud_upload</mat-icon>
            <h2>Upload Candidate Resume</h2>
            
            <button mat-raised-button color="primary" 
                    (click)="fileInput.click()" 
                    [disabled]="isUploading"
                    class="browse-btn">
              <mat-icon *ngIf="!isUploading">attach_file</mat-icon>
              <mat-spinner *ngIf="isUploading" diameter="20"></mat-spinner>
              <span *ngIf="!isUploading">Browse Files</span>
              <span *ngIf="isUploading">Uploading...</span>
            </button>
            
            <p class="drag-text">or drag and drop your resume here</p>
            <p class="supported-formats">Supported formats: PDF, DOC, DOCX</p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="upload-actions">
          <button mat-stroked-button 
                  (click)="cancelUpload()" 
                  [disabled]="isUploading">
            Cancel
          </button>
          <button mat-raised-button 
                  color="primary" 
                  (click)="uploadSelectedFile()"
                  [disabled]="!selectedFile || isUploading">
            <mat-spinner *ngIf="isUploading" diameter="20"></mat-spinner>
            <span *ngIf="!isUploading">Upload</span>
            <span *ngIf="isUploading">Uploading...</span>
          </button>
        </div>

        <!-- Selected File Display -->
        <div *ngIf="selectedFile" class="selected-file-display">
          <div class="file-info">
            <mat-icon>description</mat-icon>
            <span class="filename">{{selectedFile.name}}</span>
            <span class="filesize">({{getFileSize(selectedFile.size)}})</span>
          </div>
          
          <div class="file-actions">
            <button mat-icon-button color="warn" 
                    (click)="removeSelectedFile()" 
                    matTooltip="Remove file"
                    [disabled]="isUploading">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Resume Scores List -->
  <div class="resume-scores-section">
    <h2>Resume Scores</h2>
    <mat-card class="scores-card">
      <mat-card-content>
        <table class="scores-table">
          <thead>
            <tr>
              <th>Candidate Name</th>
              <th>Resume Score</th>
              <th>Skills</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let candidate of candidates">
              <td>
                <div class="candidate-info">
                  <strong>{{candidate.name}}</strong>
                  <small *ngIf="candidate.email">{{candidate.email}}</small>
                </div>
              </td>
              <td>
                <div class="score-container">
                  <div class="score-bar" [style.width.%]="candidate.resumeScore || 0"
                       [class.high-score]="(candidate.resumeScore || 0) >= 80"
                       [class.medium-score]="(candidate.resumeScore || 0) >= 60 && (candidate.resumeScore || 0) < 80"
                       [class.low-score]="(candidate.resumeScore || 0) < 60">
                    <span class="score-text">{{candidate.resumeScore ? (candidate.resumeScore | number:'1.1-1') : 'N/A'}}</span>
                  </div>
                </div>
              </td>
              <td>
                <div class="skills-container">
                  <span *ngIf="candidate.skills && candidate.skills.length > 0; else noSkills" 
                        class="skills-text">
                    {{candidate.skills.slice(0, 2).join(', ')}}
                    <span *ngIf="candidate.skills.length > 2" class="more-skills">
                      +{{candidate.skills.length - 2}} more
                    </span>
                  </span>
                  <ng-template #noSkills>
                    <button mat-button color="primary" class="load-skills-btn" 
                            (click)="loadCandidateSkills(candidate)"
                            [disabled]="loadingSkills[candidate.id]">
                      <mat-icon *ngIf="loadingSkills[candidate.id]">hourglass_empty</mat-icon>
                      <mat-icon *ngIf="!loadingSkills[candidate.id]">visibility</mat-icon>
                      {{loadingSkills[candidate.id] ? 'Loading...' : 'View Skills'}}
                    </button>
                  </ng-template>
                </div>
              </td>
              <td>
                <span class="status-badge" [class]="candidate.status">
                  {{candidate.status | titlecase}}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button mat-icon-button color="primary" 
                          (click)="openCandidateDetails(candidate)"
                          matTooltip="View Details">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button color="accent" 
                          (click)="refreshCandidateData(candidate)"
                          matTooltip="Refresh Data"
                          [disabled]="loadingSkills[candidate.id]">
                    <mat-icon>refresh</mat-icon>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="candidates.length === 0">
              <td colspan="5" class="no-data">
                                 <div class="empty-state">
                   <mat-icon>person_search</mat-icon>
                   <p>No candidates available</p>
                 </div>
              </td>
            </tr>
          </tbody>
        </table>
      </mat-card-content>
    </mat-card>
  </div>


</div>
