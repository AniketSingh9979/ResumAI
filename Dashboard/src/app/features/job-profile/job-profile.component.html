<div class="job-profile-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="job-profile-header">
      <div class="header-content">
        <h1 class="page-title">Job Profile Management</h1>
        <p class="page-subtitle">Upload and manage job descriptions with panel member assignments</p>
      </div>
      <button mat-raised-button color="primary" (click)="toggleUploadSection()" class="add-job-profile-btn">
        <mat-icon>{{ showUploadSection ? 'visibility_off' : 'add' }}</mat-icon>
        {{ showUploadSection ? 'Hide Upload Form' : 'Add New Job Profile' }}
      </button>
    </div>
  </div>



  <!-- Upload Section -->
  <div class="upload-section" *ngIf="showUploadSection">
    <mat-card class="upload-card">
      <mat-card-header>
        <div class="upload-header">
          <mat-icon class="upload-icon">cloud_upload</mat-icon>
          <div class="header-text">
            <mat-card-title>Upload Job Description</mat-card-title>
            <mat-card-subtitle>Add a new job profile with panel assignment</mat-card-subtitle>
          </div>
          <button mat-icon-button (click)="toggleUploadSection()" class="close-upload-btn">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </mat-card-header>
      
      <mat-card-content>
        <div class="upload-form">
          <!-- Panel Member Selection -->
          <div class="form-row">
            <mat-form-field appearance="outline" class="panel-member-field custom-dropdown panel-select-field">
              <mat-label>Select Panel Member</mat-label>
              <mat-select [(ngModel)]="selectedPanelMember" 
                         (selectionChange)="onPanelMemberChange($event)"
                         placeholder="Select Panel Member"
                         [disabled]="loading"
                         class="panel-member-select">
                <mat-option value="" disabled *ngIf="loading">
                  <div class="loading-option">
                    <mat-progress-spinner diameter="20" mode="indeterminate"></mat-progress-spinner>
                    <span>Loading panel members...</span>
                  </div>
                </mat-option>
                <ng-container *ngFor="let member of panelMembers; trackBy: trackByMemberId">
                  <mat-option [value]="member" *ngIf="!loading && member && member.name">
                    <span class="member-name-only">{{member?.name || 'Unknown'}}</span>
                  </mat-option>
                </ng-container>
                <mat-option value="" disabled *ngIf="!loading && (!panelMembers || panelMembers.length === 0)">
                  <div class="empty-option">
                    <mat-icon>info</mat-icon>
                    <span>No panel members available</span>
                  </div>
                </mat-option>
              </mat-select>
              <mat-error *ngIf="!selectedPanelMember">Please select a panel member</mat-error>
            </mat-form-field>

            <!-- Auto-filled Email Field -->
            <mat-form-field appearance="outline" class="email-field custom-dropdown">
              <mat-label>Panel Member Email</mat-label>
              <input matInput 
                     [value]="selectedPanelMember?.email || ''" 
                     readonly 
                     disabled
                     [placeholder]="selectedPanelMember ? '' : ''">
              <mat-icon matSuffix>email</mat-icon>
            </mat-form-field>
          </div>

          <!-- File Upload Area -->
          <div class="file-upload-section">
            <input 
              type="file" 
              #fileInput
              (change)="onFileSelected($event)"
              accept=".pdf,.doc,.docx,.txt"
              hidden>
            
            <div class="upload-area" 
                 [class.has-file]="selectedFile"
                 [class.drag-over]="isDragOver"
                 (click)="fileInput.click()"
                 (dragover)="onDragOver($event)"
                 (dragleave)="onDragLeave($event)"
                 (drop)="onDrop($event)">
              <div class="upload-content">
                <mat-icon>upload_file</mat-icon>
                <h3>Upload Job Description</h3>
                <p *ngIf="!selectedFile">Drag & drop your file or click to browse</p>
                <p *ngIf="selectedFile" class="file-name">
                  {{selectedFile.name}}
                  <button mat-icon-button color="warn" (click)="removeFile($event)">
                    <mat-icon>close</mat-icon>
                  </button>
                </p>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button mat-stroked-button (click)="resetForm()">Cancel</button>
            <button mat-flat-button 
                    class="upload-btn"
                    [disabled]="!selectedFile || !selectedPanelMember"
                    (click)="uploadProfile()">
              Upload Profile
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Job Descriptions Grid Section -->
  <div class="jobs-section">
    <div class="section-header">
      <h2>Uploaded Job Descriptions</h2>
      <div class="section-actions">
        <mat-form-field appearance="outline" class="search-field">
          <input matInput [(ngModel)]="searchTerm" (input)="onSearch($event.target.value)" placeholder="Search by post or panel member">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        <button mat-icon-button (click)="refreshJobs()" class="refresh-btn">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
      <p>Loading job descriptions...</p>
    </div>

    <!-- Jobs Grid -->
    <div class="jobs-grid" *ngIf="!loading && filteredJobs.length > 0">
      <mat-card *ngFor="let job of filteredJobs; let i = index" class="job-card">
        <mat-card-header>
          <mat-card-title>{{job.title || job.fileName}}</mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <div class="info-grid">
            <div class="info-item">
              <mat-icon>location_on</mat-icon>
              <span>{{job.location || 'Not specified'}}</span>
            </div>
            <div class="info-item">
              <mat-icon>work</mat-icon>
              <span>{{getExperienceYears(job.experienceLevel)}}</span>
            </div>
            <div class="info-item">
              <mat-icon>code</mat-icon>
              <span>{{getMainSkill(job)}}</span>
            </div>
            <div class="info-item">
              <mat-icon>schedule</mat-icon>
              <span>{{getTimeAgo(job.uploadDate)}}</span>
            </div>
          </div>
          
          <div class="uploaded-by">
            <mat-icon>person</mat-icon>
            <span>Uploaded by {{job.panelMember?.name || 'Unknown'}}</span>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <div class="action-buttons-left">
            <button mat-button color="primary" (click)="viewJobDetails(job)">
              <mat-icon>visibility</mat-icon>
              View Details
            </button>
            <button mat-button color="accent" (click)="downloadFile(job)">
              <mat-icon>download</mat-icon>
              Download
            </button>
          </div>
          <div class="action-buttons-right">
            <button mat-icon-button (click)="deleteJob(job)" class="delete-action">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && filteredJobs.length === 0">
      <mat-icon class="empty-icon">work_off</mat-icon>
      <h3>No Job Descriptions Found</h3>
      <p *ngIf="searchTerm">No results match your search criteria.</p>
      <p *ngIf="!searchTerm && !showUploadSection">Click the button above to start uploading job descriptions.</p>
      <p *ngIf="!searchTerm && showUploadSection">Start by uploading your first job description above.</p>
      <button mat-raised-button color="primary" (click)="toggleUploadSection()" *ngIf="!searchTerm && !showUploadSection">
        <mat-icon>add</mat-icon>
        Add Job Profile
      </button>
    </div>

    <!-- Pagination -->
    <mat-paginator 
      *ngIf="filteredJobs.length > 0"
      [length]="totalJobs" 
      [pageSize]="pageSize" 
      [pageIndex]="currentPage"
      [pageSizeOptions]="[6, 12, 24, 48]" 
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
</div>