<div class="job-profile-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <h1 class="page-title">Job Profile Management</h1>
      <p class="page-subtitle">Upload and manage job descriptions with panel member assignments</p>
    </div>
  </div>

  <!-- Upload Section -->
  <div class="upload-section">
    <mat-card class="upload-card">
      <mat-card-header>
        <div class="upload-header">
          <mat-icon class="upload-icon">cloud_upload</mat-icon>
          <div class="header-text">
            <mat-card-title>Upload Job Description</mat-card-title>
            <mat-card-subtitle>Select a panel member and upload job description file</mat-card-subtitle>
          </div>
        </div>
      </mat-card-header>
      
      <mat-card-content>
        <div class="upload-form">
          <!-- Panel Member Dropdown -->
          <div class="form-row">
            <mat-form-field appearance="outline" class="panel-member-field">
              <mat-label>Select Panel Member</mat-label>
              <mat-select [(ngModel)]="selectedPanelMember" (selectionChange)="onPanelMemberChange($event)">
                <mat-option *ngFor="let member of panelMembers" [value]="member">
                  <div class="member-option">
                    <img [src]="member.avatar" [alt]="member.name" class="member-avatar">
                    <div class="member-info">
                      <span class="member-name">{{member.name}}</span>
                      <span class="member-email">{{member.email}}</span>
                    </div>
                  </div>
                </mat-option>
              </mat-select>
            </mat-form-field>

            <!-- Auto-filled Email Field -->
            <mat-form-field appearance="outline" class="email-field">
              <mat-label>Panel Member Email</mat-label>
              <input matInput 
                     [value]="selectedPanelMember?.email || ''" 
                     readonly 
                     disabled
                     placeholder="Email will auto-fill when panel member is selected">
              <mat-icon matSuffix>email</mat-icon>
            </mat-form-field>
          </div>

          <!-- File Upload Section -->
          <div class="file-upload-section">
            <input 
              type="file" 
              #fileInput
              (change)="onFileSelected($event)"
              accept=".pdf,.doc,.docx,.txt,.rtf"
              hidden>
            
            <div class="upload-area" 
                 [class.has-file]="selectedFile"
                 [class.drag-over]="isDragOver"
                 (click)="fileInput.click()"
                 (dragover)="onDragOver($event)"
                 (dragleave)="onDragLeave($event)"
                 (drop)="onFileDrop($event)">
              
              <div class="upload-content" *ngIf="!selectedFile">
                <mat-icon class="upload-icon-large">description</mat-icon>
                <h3>Click to upload or drag and drop</h3>
                <p>Supported formats: PDF, DOC, DOCX, TXT, RTF</p>
                <button mat-raised-button color="primary" type="button">
                  <mat-icon>attach_file</mat-icon>
                  Choose File
                </button>
              </div>

              <div class="file-preview" *ngIf="selectedFile">
                <mat-icon class="file-icon">description</mat-icon>
                <div class="file-info">
                  <span class="file-name">{{selectedFile.name}}</span>
                  <span class="file-size">{{getFileSize(selectedFile.size)}}</span>
                </div>
                <button mat-icon-button (click)="removeFile($event)" class="remove-file">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button mat-raised-button 
                    color="primary" 
                    (click)="uploadJobDescription()"
                    [disabled]="!selectedFile || !selectedPanelMember || loading"
                    class="upload-btn">
              <mat-icon>cloud_upload</mat-icon>
              <span *ngIf="!loading">Upload Job Description</span>
              <span *ngIf="loading">Uploading...</span>
            </button>
            
            <button mat-button 
                    (click)="resetForm()"
                    [disabled]="loading"
                    class="reset-btn">
              <mat-icon>refresh</mat-icon>
              Reset
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Job Descriptions Grid Section -->
  <div class="jobs-section">
    <div class="section-header">
      <h2>Uploaded Job Descriptions</h2>
      <div class="section-actions">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search</mat-label>
          <input matInput [(ngModel)]="searchTerm" (input)="applySearch()" placeholder="Search by file name or panel member...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        <button mat-icon-button (click)="refreshJobs()" class="refresh-btn">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
      <p>Loading job descriptions...</p>
    </div>

    <!-- Jobs Grid -->
    <div class="jobs-grid" *ngIf="!loading && filteredJobs.length > 0">
      <div class="job-card" *ngFor="let job of filteredJobs; let i = index">
        <div class="job-header">
          <div class="file-info">
            <mat-icon class="file-type-icon">description</mat-icon>
            <div class="file-details">
              <span class="file-name">{{job.fileName}}</span>
              <span class="upload-date">{{job.uploadDate | date:'MMM d, y - h:mm a'}}</span>
            </div>
          </div>
          <div class="job-actions">
            <button mat-icon-button (click)="downloadFile(job)" class="action-btn">
              <mat-icon>download</mat-icon>
            </button>
            <button mat-icon-button (click)="viewJobDetails(job)" class="action-btn">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button (click)="deleteJob(job)" class="action-btn delete-btn">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
        
        <div class="job-content">
          <div class="panel-member-section">
            <img [src]="job.panelMember.avatar" [alt]="job.panelMember.name" class="member-avatar">
            <div class="member-details">
              <span class="member-name">{{job.panelMember.name}}</span>
              <span class="member-email">{{job.panelMember.email}}</span>
              <span class="member-expertise">{{job.panelMember.expertise}}</span>
            </div>
          </div>
          
          <div class="job-stats">
            <div class="stat-item">
              <mat-icon>folder</mat-icon>
              <span>{{getFileSize(job.fileSize)}}</span>
            </div>
            <div class="stat-item">
              <mat-icon>schedule</mat-icon>
              <span>{{getTimeAgo(job.uploadDate)}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && filteredJobs.length === 0">
      <mat-icon class="empty-icon">work_off</mat-icon>
      <h3>No Job Descriptions Found</h3>
      <p *ngIf="searchTerm">No results match your search criteria.</p>
      <p *ngIf="!searchTerm">Start by uploading your first job description above.</p>
      <button mat-raised-button color="primary" (click)="scrollToUpload()" *ngIf="!searchTerm">
        <mat-icon>cloud_upload</mat-icon>
        Upload Job Description
      </button>
    </div>

    <!-- Pagination -->
    <mat-paginator 
      *ngIf="filteredJobs.length > 0"
      [length]="totalJobs" 
      [pageSize]="pageSize" 
      [pageIndex]="currentPage"
      [pageSizeOptions]="[6, 12, 24, 48]" 
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div> 